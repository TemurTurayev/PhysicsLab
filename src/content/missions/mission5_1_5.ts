import type { Mission } from '../../types';

const mission5_1_5: Mission = {
    id: '5-1-5',
    module: 5,
    order: 5,
    title: 'Гипербола — две половинки',

    briefing: {
        situation: 'Гипербола y = 1/x — это странная функция. Она состоит из двух отдельных частей, которые никогда не встретятся.',
        task: 'Исследуй гиперболу и поймёшь, почему она не может коснуться осей координат.',
        context: 'Гипербола описывает обратную пропорциональность: чем больше x, тем меньше y. Например, скорость и время при постоянном расстоянии.',
    },

    starterCode: `from mathlab import *

# Гипербола — это функция обратной пропорциональности
# Общий вид: y = k/x

# 1. Базовая гипербола
f1 = Function("1/x")

# 2. Растянутая гипербола (k = 2)
f2 = Function("___")  # Замени ___ на 2/x

# 3. Сжатая гипербола (k = 0.5)
f3 = Function("___")  # Замени ___ на 0.5/x

# 4. Отражённая гипербола (k = -1)
f4 = Function("___")  # Замени ___ на -1/x

# Рисуем все варианты
canvas = Canvas(x_range=(-5, 5), y_range=(-5, 5))

# Асимптоты (пунктирные линии, к которым стремится гипербола)
canvas.draw_line((-5, 0), (5, 0), style="dashed", color="gray")
canvas.draw_line((0, -5), (0, 5), style="dashed", color="gray")

# Строим гиперболы
canvas.plot(f1, color="blue", name="y = 1/x")
canvas.plot(f2, color="green", name="y = 2/x")
canvas.plot(f3, color="orange", name="y = 0.5/x")
canvas.plot(f4, color="red", name="y = -1/x")

canvas.show()

# Проверяем значения (избегаем x=0!)
print(f"f1(1) = {f1(1)}")      # Должно быть 1
print(f"f1(2) = {f1(2)}")      # Должно быть 0.5
print(f"f1(-1) = {f1(-1)}")    # Должно быть -1
print(f"f1(0.5) = {f1(0.5)}")  # Должно быть 2
`,

    theory: [
        '# Гипербола',
        '',
        'Гипербола — это функция вида:',
        '',
        '$$y = \\frac{k}{x}$$',
        '',
        'Простейший случай:',
        '',
        '$$y = \\frac{1}{x}$$',
        '',
        '## Свойства гиперболы y = 1/x',
        '',
        '**Область определения:** $x \\in (-\\infty, 0) \\cup (0, +\\infty)$',
        '',
        '⚠️ **Важно:** $x \\neq 0$ (деление на ноль невозможно!)',
        '',
        '**Область значений:** $y \\in (-\\infty, 0) \\cup (0, +\\infty)$',
        '',
        '⚠️ **Важно:** $y \\neq 0$ (функция никогда не равна нулю)',
        '',
        '**Симметрия:** Функция **нечётная**, т.е. $f(-x) = -f(x)$',
        '',
        '## Асимптоты',
        '',
        '**Асимптота** — это прямая, к которой функция бесконечно близко приближается, но никогда не касается.',
        '',
        'У гиперболы **две асимптоты:**',
        '',
        '1. **Вертикальная асимптота:** $x = 0$ (ось Y)',
        '   - Когда $x \\to 0$, функция $y \\to \\pm\\infty$',
        '',
        '2. **Горизонтальная асимптота:** $y = 0$ (ось X)',
        '   - Когда $x \\to \\pm\\infty$, функция $y \\to 0$',
        '',
        '```',
        '         │  ╱',
        '         │ ╱',
        '         │╱',
        '    ─────┼───── ← горизонтальная асимптота (y=0)',
        '        ╱│',
        '       ╱ │',
        '      ╱  │',
        '         ↑',
        '   вертикальная',
        '   асимптота (x=0)',
        '```',
        '',
        '## Влияние коэффициента k',
        '',
        '**y = k/x**',
        '',
        '- Если $k \u003e 0$ → ветви в I и III четвертях',
        '- Если $k \u003c 0$ → ветви в II и IV четвертях',
        '- Чем больше $|k|$, тем дальше ветви от осей',
        '',
        '**Примеры:**',
        '',
        '- $y = \\frac{2}{x}$ — в 2 раза дальше от осей',
        '- $y = \\frac{0.5}{x}$ — в 2 раза ближе к осям',
        '- $y = -\\frac{1}{x}$ — отражение относительно оси X',
        '',
        '## Обратная пропорциональность',
        '',
        'Гипербола описывает **обратную пропорциональность:**',
        '',
        '$$x \\cdot y = k$$',
        '',
        '**Физический смысл:**',
        '',
        '- Скорость × Время = Расстояние (постоянное)',
        '  - Чем выше скорость, тем меньше времени нужно',
        '',
        '- Цена × Количество = Бюджет (постоянный)',
        '  - Чем дороже товар, тем меньше купишь',
        '',
        '- Давление × Объём = Константа (закон Бойля-Мариотта)',
        '  - Чем больше давление, тем меньше объём газа',
        '',
        '## Важные точки',
        '',
        '| x | y = 1/x |',
        '|---|---------|',
        '| 1 | 1       |',
        '| 2 | 0.5     |',
        '| 0.5 | 2     |',
        '| -1 | -1     |',
        '| -2 | -0.5   |',
        '',
        'Обрати внимание: при $x = 1$ получается $y = 1$ (точка (1, 1) на графике).',
    ],

    checks: [
        {
            type: 'function_expression',
            message_success: '✓ Растянутая гипербола создана!',
            message_fail: '✗ Проверь f2. Должно быть 2/x',
            expected_expression: '2/x',
        },
        {
            type: 'function_expression',
            message_success: '✓ Сжатая гипербола создана!',
            message_fail: '✗ Проверь f3. Должно быть 0.5/x',
            expected_expression: '0.5/x',
        },
        {
            type: 'function_expression',
            message_success: '✓ Отражённая гипербола создана!',
            message_fail: '✗ Проверь f4. Должно быть -1/x',
            expected_expression: '-1/x',
        },
        {
            type: 'function_values',
            message_success: '✓ Значения вычислены правильно!',
            message_fail: '✗ Проверь вычисления. f1(1) = 1, f1(2) = 0.5',
            test_values: {
                '1': 1,
                '2': 0.5,
                '-1': -1,
                '0.5': 2,
            },
        },
        {
            type: 'canvas_plot',
            message_success: '✓ Все гиперболы построены, асимптоты показаны!',
            message_fail: '✗ Убедись, что все функции построены',
        },
    ],

    hints: [
        {
            level: 1,
            text: 'Подсказка 1: Для записи дроби используй прямую косую черту /. Например, 1/x означает "один делить на x".',
        },
        {
            level: 2,
            text: 'Подсказка 2: Чтобы получить k/x, просто напиши число, затем /, затем x. Например: 2/x или 0.5/x',
        },
        {
            level: 3,
            text: 'Подсказка 3: Полное решение:\nf2 = Function("2/x")\nf3 = Function("0.5/x")\nf4 = Function("-1/x")\n\nОбрати внимание на асимптоты — гипербола к ним стремится, но никогда не касается!',
        },
    ],

    rewards: {
        xp: 85,
        stars: {
            bronze: 'Познакомился с гиперболой',
            silver: 'Понял концепцию асимптот',
            gold: 'Увидел обратную пропорциональность в действии',
        },
    },

    metadata: {
        difficulty: 'basic',
        estimatedTime: 15,
        prerequisites: ['5-1-4'],
        tags: ['функции', 'гипербола', 'асимптоты', 'обратная пропорциональность', 'область определения'],
    },
};

export default mission5_1_5;
